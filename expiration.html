<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#FC5200"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-10-28T15:11:52.824876656"><title>Expiration | Apollo Kotlin Normalized Cache</title><script type="application/json" id="virtual-toc-data">[{"id":"server-controlled-max-age","level":0,"title":"Server-controlled max-age","anchor":"#server-controlled-max-age"},{"id":"client-controlled-max-age","level":0,"title":"Client-controlled max-age","anchor":"#client-controlled-max-age"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b575/app.css" rel="stylesheet"><link href="static/custom.css" rel="stylesheet"><link rel="icon" type="image/png" sizes="16x16" href="images/favicon-96x96.png"><link rel="icon" type="image/png" sizes="32x32" href="images/favicon-192x192.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Expiration | Apollo Kotlin Normalized Cache"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Apollo Kotlin Normalized Cache Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/expiration.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Expiration | Apollo Kotlin Normalized Cache"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/expiration.html#webpage",
    "url": "writerside-documentation/expiration.html",
    "name": "Expiration | Apollo Kotlin Normalized Cache",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Apollo Kotlin Normalized Cache Help"
}</script><!-- End Schema.org --></head><body data-id="expiration" data-main-title="Expiration" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs=""><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Apollo Kotlin Normalized Cache  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="expiration" id="expiration.md">Expiration</h1><p id="z63u2b9_3">The cache can be configured to store expiration information using a max-age. This is also sometimes referred to as TTL (Time To Live) or freshness.</p><p id="z63u2b9_4">Max-age can be configured by the server, by the client, or both.</p><section class="chapter"><h2 id="server-controlled-max-age" data-toc="server-controlled-max-age">Server-controlled max-age</h2><p id="z63u2b9_7">When receiving a response from the server, the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control" id="z63u2b9_13" data-external="true" rel="noopener noreferrer"><code class="code" id="z63u2b9_15">Cache-Control</code> HTTP header</a> can be used to determine the <span class="control" id="z63u2b9_14">max age</span> of the fields in the response.</p><aside class="prompt" data-type="tip" data-title="" id="z63u2b9_8"><p id="z63u2b9_16">Apollo Server can be configured to include the <code class="code" id="z63u2b9_17">Cache-Control</code> header in responses. See the <a href="https://www.apollographql.com/docs/apollo-server/performance/caching/" id="z63u2b9_18" data-external="true" rel="noopener noreferrer">caching documentation</a> for more information.</p></aside><aside class="prompt" data-type="note" data-title="" id="z63u2b9_9"><p id="z63u2b9_19">The <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Expires" id="z63u2b9_20" data-external="true" rel="noopener noreferrer"><code class="code" id="z63u2b9_22">Expires</code> HTTP header</a> is not supported. Only <code class="code" id="z63u2b9_21">Cache-Control</code> is.</p></aside><p id="z63u2b9_10">The cache can be configured to store the <span class="control" id="z63u2b9_23">expiration date</span> of the received fields in the corresponding records. To do so, call <a href="https://apollographql.github.io/apollo-kotlin-normalized-cache/kdoc/normalized-cache/com.apollographql.cache.normalized/store-expiration-date.html?query=fun%20%3CT%3E%20MutableExecutionOptions%3CT%3E.storeExpirationDate(storeExpirationDate:%20Boolean):%20T" id="z63u2b9_24" data-external="true" rel="noopener noreferrer"><code class="code" id="z63u2b9_26">.storeExpirationDate(true)</code></a>, and set your client's cache resolver to <a href="https://apollographql.github.io/apollo-kotlin-normalized-cache/kdoc/normalized-cache/com.apollographql.cache.normalized.api/-cache-control-cache-resolver/index.html" id="z63u2b9_25" data-external="true" rel="noopener noreferrer"><code class="code" id="z63u2b9_27">CacheControlCacheResolver</code></a>:</p><div class="code-block" data-lang="kotlin">
val apolloClient = ApolloClient.builder()
  .serverUrl(&quot;https://example.com/graphql&quot;)
  .storeExpirationDate(true)
  .normalizedCache(
    normalizedCacheFactory = /*...*/,
    cacheResolver = CacheControlCacheResolver(),
  )
  .build()
</div><p id="z63u2b9_12"><span class="control" id="z63u2b9_28">Expiration dates</span> are stored and when a field is resolved, the cache resolver will check if the field is stale. If so, it will return an error..</p></section><section class="chapter"><h2 id="client-controlled-max-age" data-toc="client-controlled-max-age">Client-controlled max-age</h2><p id="z63u2b9_29">When storing fields, the cache can also store their <span class="control" id="z63u2b9_36">received date</span>. This date can then be compared to the current date when resolving a field to determine if its age is above its <span class="control" id="z63u2b9_37">max age</span>.</p><p id="z63u2b9_30">To store the <span class="control" id="z63u2b9_38">received date</span> of fields, call <a href="https://apollographql.github.io/apollo-kotlin-normalized-cache/kdoc/normalized-cache/com.apollographql.cache.normalized/store-receive-date.html?query=fun%20%3CT%3E%20MutableExecutionOptions%3CT%3E.storeReceivedDate(storeReceivedDate:%20Boolean):%20T" id="z63u2b9_39" data-external="true" rel="noopener noreferrer"><code class="code" id="z63u2b9_41">.storeReceivedDate(true)</code></a>, and set your client's cache resolver to <a href="https://apollographql.github.io/apollo-kotlin-normalized-cache/kdoc/normalized-cache/com.apollographql.cache.normalized.api/-cache-control-cache-resolver/index.html" id="z63u2b9_40" data-external="true" rel="noopener noreferrer"><code class="code" id="z63u2b9_42">CacheControlCacheResolver</code></a>:</p><div class="code-block" data-lang="kotlin">
val apolloClient = ApolloClient.builder()
  .serverUrl(&quot;https://example.com/graphql&quot;)
  .storeReceivedDate(true)
  .normalizedCache(
    normalizedCacheFactory = /*...*/,
    cacheResolver = CacheControlCacheResolver(maxAgeProvider),
  )
  .build()
</div><aside class="prompt" data-type="tip" data-title="" id="z63u2b9_32"><p id="z63u2b9_43">Expiration dates and received dates can be both stored to combine server-controlled and client-controlled expiration strategies.</p></aside><p id="z63u2b9_33">The <span class="control" id="z63u2b9_44">max age</span> of fields can be configured either programmatically, or declaratively in the schema. This is done by passing a <a href="https://apollographql.github.io/apollo-kotlin-normalized-cache/kdoc/normalized-cache/com.apollographql.cache.normalized.api/-max-age-provider/index.html?query=interface%20MaxAgeProvider" id="z63u2b9_45" data-external="true" rel="noopener noreferrer"><code class="code" id="z63u2b9_47">MaxAgeProvider</code></a> to the <code class="code" id="z63u2b9_46">CacheControlCacheResolver</code>.</p><section class="chapter"><h3 id="global-max-age" data-toc="global-max-age">Global max age</h3><p id="z63u2b9_48">To set a global maximum age for all fields, pass a <a href="https://apollographql.github.io/apollo-kotlin-normalized-cache/kdoc/normalized-cache/com.apollographql.cache.normalized.api/-global-max-age-provider/index.html?query=class%20GlobalMaxAgeProvider(maxAge:%20Duration)%20:%20MaxAgeProvider" id="z63u2b9_50" data-external="true" rel="noopener noreferrer"><code class="code" id="z63u2b9_52">GlobalMaxAgeProvider</code></a> to the <code class="code" id="z63u2b9_51">CacheControlCacheResolver</code>:</p><div class="code-block" data-lang="kotlin">
    cacheResolver = CacheControlCacheResolver(GlobalMaxAgeProvider(1.hours)),
</div></section><section class="chapter"><h3 id="max-age-per-type-and-field" data-toc="max-age-per-type-and-field">Max age per type and field</h3><section class="chapter"><h4 id="programmatically" data-toc="programmatically">Programmatically</h4><p id="z63u2b9_55">Use a <a href="https://apollographql.github.io/apollo-kotlin-normalized-cache/kdoc/normalized-cache/com.apollographql.cache.normalized.api/-schema-coordinates-max-age-provider/index.html?query=class%20SchemaCoordinatesMaxAgeProvider(maxAges:%20Map%3CString,%20MaxAge%3E,%20defaultMaxAge:%20Duration)%20:%20MaxAgeProvider" id="z63u2b9_58" data-external="true" rel="noopener noreferrer"><code class="code" id="z63u2b9_59">SchemaCoordinatesMaxAgeProvider</code></a> to specify a max age per type and/or field:</p><div class="code-block" data-lang="kotlin">
cacheResolver = CacheControlCacheResolver(
  SchemaCoordinatesMaxAgeProvider(
    maxAges = mapOf(
      &quot;Query.cachedBook&quot; to MaxAge.Duration(60.seconds),
      &quot;Query.reader&quot; to MaxAge.Duration(40.seconds),
      &quot;Post&quot; to MaxAge.Duration(4.minutes),
      &quot;Book.cachedTitle&quot; to MaxAge.Duration(30.seconds),
      &quot;Reader.book&quot; to MaxAge.Inherit,
    ), 
    defaultMaxAge = 1.hours,
  )
),
</div><p id="z63u2b9_57">Note that this provider replicates the behavior of Apollo Server's <a href="https://www.apollographql.com/docs/apollo-server/performance/caching/#default-maxage" id="z63u2b9_60" data-external="true" rel="noopener noreferrer"><code class="code" id="z63u2b9_62">@cacheControl</code> directive</a> when it comes to defaults and the meaning of <code class="code" id="z63u2b9_61">Inherit</code>.</p></section><section class="chapter"><h4 id="declaratively" data-toc="declaratively">Declaratively</h4><p id="z63u2b9_63">To declare the maximum age of types and fields in the schema, use the <code class="code" id="z63u2b9_67">@cacheControl</code> and <code class="code" id="z63u2b9_68">@cacheControlField</code> directive:</p><div class="code-block" data-lang="none">
# First import the directives
extend schema @link(
  url: &quot;https://specs.apollo.dev/cache/v0.3&quot;,
  import: [&quot;@cacheControl&quot;, &quot;@cacheControlField&quot;]
)

# Then extend your types
extend type Query @cacheControl(maxAge: 60)
  @cacheControlField(name: &quot;cachedBook&quot;, maxAge: 60)
  @cacheControlField(name: &quot;reader&quot;, maxAge: 40)

extend type Post @cacheControl(maxAge: 240)

extend type Book @cacheControlField(name: &quot;cachedTitle&quot;, maxAge: 30)

extend type Reader @cacheControlField(name: &quot;book&quot;, inheritMaxAge: true)
</div><p id="z63u2b9_65">This generates a map in <code class="code" id="z63u2b9_69">yourpackage.cache.Cache.maxAges</code>, that you can pass to the <code class="code" id="z63u2b9_70">SchemaCoordinatesMaxAgeProvider</code>:</p><div class="code-block" data-lang="kotlin">
cacheResolver = CacheControlCacheResolver(
  SchemaCoordinatesMaxAgeProvider(
    maxAges = Cache.maxAges,
    defaultMaxAge = 1.hours,
  )
)
</div></section></section></section><div class="last-modified">Last modified: 09 October 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="migration-guide.html" class="navigation-links__prev">Migration guide</a><a href="options.html" class="navigation-links__next">Query options</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b575/app.js"></script></body></html>